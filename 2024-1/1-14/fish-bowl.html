<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="stylesheet" href="fish-bowl.css">
  <title>Document</title>
</head>
<body>
  <div id="fishbowl" class="fishbowl">
    <div class="fishbowl__pool"></div>
    <div class="fishbowl__background"></div>
    <div class="fishbowl__bottom"></div>
    <div class="fishbowl__decoration">
      <div class="fishbowl__seaweed fishbowl__seaweed--1"></div>
      <div class="fishbowl__seaweed fishbowl__seaweed--2"></div>
      <div class="fishbowl__seaweed fishbowl__seaweed--3"></div>
    </div>
    <div class="fishbowl__water">
      <div id="fish" class="fishbowl__fish">
        <div class="fishbowl__fish-tail"></div>
      </div>
      <div class="fishbowl__water-color"></div>
    </div>
    <div class="fishbowl__top"></div>
    <div id="tap" class="fishbowl__tap">
      <div class="fishbowl__tap-base"></div>
      <div class="fishbowl__tap-handle"></div>
      <div class="fishbowl__tap-stream"></div>
      <div class="fishbowl__tap-end"></div>
      <div class="fishbowl__tap-head"></div>
      <div class="fishbowl__tap-text">Click to refill</div>
    </div>
  </div>

<script>
  let fill = 90;
  let intervalId = null;
  const fishbowl = document.getElementById('fishbowl');
  const fish = document.getElementById('fish');
  const tap = document.getElementById('tap');

  const emptyingFn = () => setInterval(() => {
    fill = fill - 1;
    fishbowl.style = `--filling: ${fill}`;
    if (fill <= 0) {
      clearInterval(intervalId);
    } else if (fill < 20) {
      fish.classList.add('fishbowl__fish--dead');
    } else if (fill < 50) {
      fish.classList.add('fishbowl__fish--dying');
    } else {
      fish.classList.remove('fishbowl__fish--dying');
      fish.classList.remove('fishbowl__fish--dead');
    }
  }, 200);

  intervalId = emptyingFn();

  tap.addEventListener('click', () => {
    tap.classList.add('fishbowl__tap--active');
    setTimeout(() => tap.classList.remove('fishbowl__tap--active'), 500);
    if (fill <= 0) {
      intervalId = emptyingFn();
      fish.classList.add('fishbowl__fish--floating');
    }
    fill = Math.min(fill + 20, 90);
  });
</script>
</body>
</html>